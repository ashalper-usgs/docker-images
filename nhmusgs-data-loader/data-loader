#! /bin/bash
#
#  U.S. Geological Survey
#
#  File - data-loader
#
#  Purpose - Docker entry-point for data-loader container.
#
#  Author - Andrew Halper
#

set -e

# if gridmetetl, HRU shapefiles are not present...
if [ ! -d /nhm/gridmetetl/nhm_hru_data_gfv11 ]; then
    cd /nhm/gridmetetl
    # ...download archive
    wget --waitretry=3 --retry-connrefused "$HRU_SOURCE"
    # uncompress archive
    unzip $HRU_DATA_PKG
    rm -f "$HRU_DATA_PKG"
    chown -R nhm /nhm/gridmetetl
    chmod -R 766 /nhm/gridmetetl
else
    echo "HRU shapefiles already loaded"
fi

# if PRMS workspace is not present...
if [ ! -d /nhm/NHM-PRMS_CONUS_GF_1_1 ]; then
    cd /nhm
    # ...download it
    wget --waitretry=3 --retry-connrefused "$PRMS_SOURCE"
    unzip "$PRMS_DATA_PKG"
    rm -f "$PRMS_DATA_PKG"
    chown -R nhm /nhm/NHM-PRMS_CONUS_GF_1_1
    chmod -R 766 /nhm/NHM-PRMS_CONUS_GF_1_1
else
    echo "PRMS workspace already loaded"
fi
